<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Es Tu Dia Jugant</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      min-height: 100vh;
      height: 100vh;
      width: 100vw;
      display: flex;
      flex-direction: column;
      background: #f0faff;
      font-family: 'Comic Neue', 'Comic Sans MS', cursive;
    }
    .area-superior {
      width: 100vw;
      min-height: 48px;
      max-height: 60px;
      background: #fff;
      color: #222;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      font-weight: bold;
      letter-spacing: 1px;
      box-shadow: 0 2px 8px #0002;
    }
    .area-superior .cronometro {
      color: #222;
      border-radius: 8px;
      padding: 4px 12px;
      font-size: 1.1em;
      font-variant-numeric: tabular-nums;
      min-width: 48px;
      display: inline-block;
      text-align: center;
    }
    .area-superior .ajudaText {
      color: #222;
      font-size: 1.1em;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .area-superior .aciertos {
      color: #222;
      font-size: 1.1em;
      font-weight: bold;
      min-width: 18px;
    }
    .area-superior .check {
      font-size: 1.3em;
      color: #22bb22;
    }
    .area-superior svg {
      fill: #222;
      stroke: #222;
    }
    .area-superior .superior-izq {
      flex: 0 0 auto;
      display: flex;
      align-items: center;
      min-width: 60px;
      justify-content: flex-start;
    }
    .area-superior .superior-centro {
      flex: 1 1 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 0;
    }
    .area-superior .superior-der {
      flex: 0 0 auto;
      display: flex;
      align-items: center;
      min-width: 60px;
      justify-content: flex-end;
      gap: 6px;
    }
    .area-central {
      flex: 1 1 auto;
      width: 100vw;
      min-height: 0;
      display: flex;
      flex-direction: column;
      background: #fff;
      overflow: hidden;
    }
    .area-inferior {
      width: 100vw;
      min-height: 48px;
      max-height: 60px;
      background: #fff;
      color: #222;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1em;
      letter-spacing: 1px;
      box-shadow: 0 -2px 8px #0002;
    }
    .area-inferior button {
      color: #222;
    }
    .area-inferior svg {
      fill: #222;
      stroke: #222;
    }
    .area-inferior #contadorRondas {
      color: #222;
    }
    /* Estils per a la pantalla d'inici */
    #pantallaInicio {
      position: fixed;
      z-index: 9999;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
      .boton-respuesta {
        border: none;
        border-radius: 18px;
        font-size: clamp(1.3em, 8vw, 2.6em);
        font-weight: bold;
        color: white;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 28px 16px;
        min-height: 72px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 16px rgba(0,0,0,0.13);
      }
    #pantallaInicio span.titol {
      color: #fff;
      font-size: 3em;
      font-weight: bold;
      letter-spacing: 0.08em;
    }
    #pantallaInicio button#btnIniciarJuego {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #2196f3;
      border: none;
      border-radius: 18px;
      width: 110px;
      height: 110px;
      box-shadow: 0 4px 16px #0008;
      cursor: pointer;
    }
    #pantallaInicio button#btnIniciarJuego svg {
      width: 48px;
      height: 48px;
    }
    #pantallaInicio button#btnIniciarJuego span {
      color: #fff;
      font-size: 1.3em;
      font-weight: bold;
      margin-top: 8px;
      letter-spacing: 1px;
    }
    #pantallaInicio span.subtitol {
      color: #fff;
      font-size: 1.25em;
      margin-top: 18px;
      max-width: 90vw;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- Pantalla de inicio -->
  <div id="pantallaInicio">
    <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:end;width:100%;">
      <span class="titol" id="gameTitle">JOC</span>
      <span id="gameTags" style="color:#fff;font-size:1em;margin-top:8px;display:none;"></span>
    </div>
    <div style="flex:0;display:flex;align-items:center;justify-content:center;width:100%;margin:32px 0 18px 0;">
      <button id="btnIniciarJuego">
        <svg width="48" height="48" viewBox="0 0 48 48"><polygon points="16,10 40,24 16,38" fill="white"/></svg>
        <span style="color:#fff;font-size:1.3em;font-weight:bold;margin-top:8px;letter-spacing:1px;">INICIAR</span>
      </button>
    </div>
    <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:start;width:100%;">
      <span class="subtitol" id="gameSubtitle">...</span>
      <span id="gameDesc" style="color:#fff;font-size:1.1em;margin-top:10px;max-width:90vw;text-align:center;display:none;"></span>
    </div>
  </div>

  <div class="area-superior">
    <div class="superior-izq">
      <span id="cronometro" class="cronometro">00:00</span>
    </div>
    <div class="superior-centro">
      <span id="ajudaText" class="ajudaText">...</span>
    </div>
    <div class="superior-der">
      <span class="check">&#10003;</span>
      <span id="aciertos" class="aciertos">0</span>
    </div>
  </div>
  <div class="area-central" id="areaCentral">
    <div class="juego-container" id="juegoContainer" style="display: none;">
      <div class="zona-pregunta">
        <div class="texto-pregunta" id="textoPregunta"></div>
      </div>
      <div class="zona-respuestas" id="zonaRespuestas"></div>
    </div>
    <div id="mensajeBienvenida" style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 1.5em; color: #666; text-align: center;">
      Pulsa "INICIAR" per començar el joc
    </div>
  </div>
  <div class="area-inferior">
    <div class="inferior-izq" style="flex:0 0 auto; display:flex; align-items:center; min-width:60px; justify-content:flex-start;">
      <button id="btnMenu" style="background:none;border:none;cursor:pointer;padding:8px;display:flex;align-items:center;">
        <svg width="32" height="32" viewBox="0 0 32 32"><rect y="6" width="32" height="4" rx="2"/><rect y="14" width="32" height="4" rx="2"/><rect y="22" width="32" height="4" rx="2"/></svg>
      </button>
    </div>
    <div class="inferior-centro" style="flex:1 1 auto; display:flex; align-items:center; justify-content:center; min-width:0;">
      <span id="contadorRondas" style="font-size:1.1em; font-weight:bold;">1 de 10</span>
    </div>
    <div class="inferior-der" style="flex:0 0 auto; display:flex; align-items:center; min-width:60px; justify-content:flex-end;">
      <button id="btnFullscreen" style="background:none;border:none;cursor:pointer;padding:8px;display:flex;align-items:center;">
        <svg width="28" height="28" viewBox="0 0 32 32"><path d="M4 12V4h8M28 12V4h-8M4 20v8h8M28 20v8h-8" stroke-width="3" fill="none" stroke-linecap="round"/></svg>
      </button>
    </div>
  </div>
<script type="module">
// Mostrar los campos del GameContract: nombre, descripcion, tags
const juegoRaw = localStorage.getItem('stdj_chooseone');
let juego = null;
if (juegoRaw) {
  try {
    juego = JSON.parse(juegoRaw);
    // nombre
    document.getElementById('gameTitle').textContent = juego.nombre || juego.titol || 'JOC';
    // descripcion
    if (juego.descripcion) {
      document.getElementById('gameDesc').textContent = juego.descripcion;
      document.getElementById('gameDesc').style.display = 'block';
    } else if (juego.subtitol) {
      document.getElementById('gameDesc').textContent = juego.subtitol;
      document.getElementById('gameDesc').style.display = 'block';
    } else {
      document.getElementById('gameDesc').style.display = 'none';
    }
    // subtitulo (si existe)
    document.getElementById('gameSubtitle').textContent = juego.subtitol || '';
    // tags
    if (Array.isArray(juego.tags) && juego.tags.length > 0) {
      document.getElementById('gameTags').textContent = 'Etiquetes: ' + juego.tags.join(', ');
      document.getElementById('gameTags').style.display = 'block';
    } else {
      document.getElementById('gameTags').style.display = 'none';
    }
    // ayudaText
    document.getElementById('ajudaText').textContent = juego.nombre || juego.titol || 'JOC';
  } catch (e) {
    document.getElementById('gameTitle').textContent = 'JOC';
    document.getElementById('gameSubtitle').textContent = 'Error carregant joc';
    document.getElementById('ajudaText').textContent = 'JOC';
    document.getElementById('gameDesc').style.display = 'none';
    document.getElementById('gameTags').style.display = 'none';
  }
} else {
  document.getElementById('gameTitle').textContent = 'JOC';
  document.getElementById('gameSubtitle').textContent = 'No s\'ha seleccionat cap joc';
  document.getElementById('ajudaText').textContent = 'JOC';
  document.getElementById('gameDesc').style.display = 'none';
  document.getElementById('gameTags').style.display = 'none';
}
// --- Lógica de juego tipo indefinits ---
import { shuffle } from '../js/utils.js';

let preguntasSeleccionadas = [];
let preguntaActual = 0;
let aciertos = 0;
let tiempoInicio = 0;
let cronometroInterval = null;

const coloresBotones = [
  '#e74c3c', '#3498db', '#2ecc71', '#f39c12',
  '#9b59b6', '#1abc9c', '#e67e22', '#34495e',
  '#e91e63', '#673ab7', '#00bcd4', '#4caf50'
];

function iniciarJuego() {
  document.getElementById('pantallaInicio').style.display = 'none';
  document.getElementById('mensajeBienvenida').style.display = 'none';
  document.getElementById('juegoContainer').style.display = 'flex';
  preguntaActual = 0;
  aciertos = 0;
  tiempoInicio = Date.now();
  actualizarContadores();
  mostrarPregunta();
  if (cronometroInterval) clearInterval(cronometroInterval);
  cronometroInterval = setInterval(actualizarCronometro, 1000);
}

function cargarPreguntas() {
  if (!juego || !Array.isArray(juego.preguntas)) {
    alert('No hay preguntas en el juego');
    return;
  }
  preguntasSeleccionadas = shuffle([...juego.preguntas]).slice(0, 10);
  iniciarJuego();
}

function actualizarCronometro() {
  if (!tiempoInicio) return;
  const tiempoTranscurrido = Math.floor((Date.now() - tiempoInicio) / 1000);
  const minutos = Math.floor(tiempoTranscurrido / 60);
  const segundos = tiempoTranscurrido % 60;
  document.getElementById('cronometro').textContent = `${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;
}
function mostrarPregunta() {
  if (preguntaActual >= preguntasSeleccionadas.length) {
    finalizarJuego();
    return;
  }
  const pregunta = preguntasSeleccionadas[preguntaActual];
  document.getElementById('textoPregunta').textContent = pregunta.pregunta;
  const zonaRespuestas = document.getElementById('zonaRespuestas');
  zonaRespuestas.innerHTML = '';
  const respuestas = shuffle([
    ...((pregunta.ok || []).map(text => ({ text, isCorrect: true }))),
    ...((pregunta.nok || []).map(text => ({ text, isCorrect: false })))
  ]);
  const numRespuestas = respuestas.length;
  if (numRespuestas <= 2) {
    zonaRespuestas.style.gridTemplateColumns = 'repeat(1, 1fr)';
  } else if (numRespuestas <= 4) {
    zonaRespuestas.style.gridTemplateColumns = 'repeat(2, 1fr)';
  } else {
    zonaRespuestas.style.gridTemplateColumns = 'repeat(3, 1fr)';
  }
  const colorOffset = Math.floor(Math.random() * coloresBotones.length);
  respuestas.forEach((respuesta, index) => {
    const boton = document.createElement('button');
    boton.className = 'boton-respuesta';
    boton.textContent = respuesta.text;
    boton.dataset.correcta = respuesta.isCorrect ? "1" : "0";
    boton.style.backgroundColor = coloresBotones[(index + colorOffset) % coloresBotones.length];
    boton.onclick = () => manejarRespuesta(index, boton);
    zonaRespuestas.appendChild(boton);
  });
  actualizarContadores();
}

function manejarRespuesta(indiceSeleccionado, botonClickeado) {
  const pregunta = preguntasSeleccionadas[preguntaActual];
  const esCorrecta = botonClickeado.dataset.correcta === "1";
  const botones = document.querySelectorAll('.boton-respuesta');
  botones.forEach(btn => btn.onclick = null);
  const simbolo = document.createElement('div');
  simbolo.className = 'simbolo-resultado';
  simbolo.textContent = esCorrecta ? '✓' : '✗';
  simbolo.style.color = esCorrecta ? '#2ecc71' : '#e74c3c';
  botonClickeado.appendChild(simbolo);
  if (esCorrecta) {
    aciertos++;
    actualizarContadores();
    setTimeout(() => {
      preguntaActual++;
      mostrarPregunta();
    }, 1500);
  } else {
    setTimeout(() => {
      const btnCorrecto = Array.from(botones).find(btn => btn.dataset.correcta === "1");
      if (btnCorrecto) {
        const check = document.createElement('div');
        check.className = 'simbolo-resultado';
        check.textContent = '✓';
        check.style.color = '#2ecc71';
        btnCorrecto.appendChild(check);
      }
      setTimeout(() => {
        preguntaActual++;
        mostrarPregunta();
      }, 1300);
    }, 1300);
  }
}

function finalizarJuego() {
  // Ocultar el contenedor de preguntas y mostrar pantalla final
  document.getElementById('juegoContainer').style.display = 'none';
  document.getElementById('mensajeBienvenida').style.display = 'none';
  // Crear pantalla final
  const areaCentral = document.getElementById('areaCentral');
  areaCentral.innerHTML = `
    <div class="pantalla-final">
      <div class="mensaje-final">¡TERMINASTE EL JUEGO!</div>
      <div class="puntuacion-final">
        <div>Aciertos: ${aciertos} de ${preguntasSeleccionadas.length}</div>
        <div>Porcentaje: ${Math.round((aciertos / preguntasSeleccionadas.length) * 100)}%</div>
      </div>
      <button id="btnVolverAJugar" style="margin-top:32px;padding:12px 24px;font-size:1.2em;border-radius:12px;border:none;background:#fff;color:#764ba2;font-weight:bold;cursor:pointer;">Volver a jugar</button>
    </div>
  `;
  // Listener para volver a jugar
  document.getElementById('btnVolverAJugar').onclick = function() {
    // Restaurar pantalla de inicio y contenedores
    areaCentral.innerHTML = `
      <div class=\"juego-container\" id=\"juegoContainer\" style=\"display: none;\">
        <div class=\"zona-pregunta\">
          <div class=\"texto-pregunta\" id=\"textoPregunta\"></div>
        </div>
        <div class=\"zona-respuestas\" id=\"zonaRespuestas\"></div>
      </div>
      <div id=\"mensajeBienvenida\" style=\"display: flex; align-items: center; justify-content: center; height: 100%; font-size: 1.5em; color: #666; text-align: center;\">
        Pulsa \"INICIAR\" per començar el joc
      </div>
    `;
    document.getElementById('pantallaInicio').style.display = 'flex';
    document.getElementById('juegoContainer').style.display = 'none';
    document.getElementById('mensajeBienvenida').style.display = 'flex';
    preguntaActual = 0;
    aciertos = 0;
    tiempoInicio = 0;
    document.getElementById('cronometro').textContent = '00:00';
    actualizarContadores();
  };
}

function actualizarContadores() {
  document.getElementById('aciertos').textContent = aciertos;
  document.getElementById('contadorRondas').textContent = `${preguntaActual + 1} de ${preguntasSeleccionadas.length}`;
}


// --- Menú modal igual que indefinits ---
let cronometroPausado = false;
let tiempoPausa = 0;

function mostrarMenuModal() {
  // Pausar cronómetro
  if (cronometroInterval && !cronometroPausado) {
    clearInterval(cronometroInterval);
    cronometroPausado = true;
    tiempoPausa = Date.now();
  }
  const modal = document.createElement('div');
  modal.id = 'menuModal';
  modal.style.display = 'block';
  modal.innerHTML = `
    <div style="position:fixed;z-index:9998;top:0;left:0;width:100vw;height:100vh;background:rgba(40,40,40,0.45);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);"></div>
    <div style="position:fixed;z-index:9999;left:24px;bottom:24px;min-width:220px;max-width:90vw;padding:0 0 18px 0;background:#23242a;border:2px solid #fff;border-radius:18px;box-shadow:0 8px 32px #0008;display:flex;flex-direction:column;align-items:stretch;">
      <div style="padding:18px 18px 8px 18px;font-size:1.3em;font-weight:bold;color:#fff;">Menú</div>
      <div style="height:2px;background:linear-gradient(90deg,#fff,#bbb);margin:0 0 10px 0;"></div>
  <button id="btnEnviarRespuestas" disabled style="margin:0 18px 10px 18px;padding:12px;font-size:1em;background:#444;color:#aaa;border:none;border-radius:8px;cursor:not-allowed;opacity:0.7;">Enviar respuestas</button>
  <button id="btnMenuPrincipal" style="margin:0 18px 10px 18px;padding:12px;font-size:1em;background:#eee;color:#23242a;border:none;border-radius:8px;font-weight:bold;cursor:pointer;">Volver al menú</button>
  <button id="btnReiniciarJuego" style="margin:0 18px 10px 18px;padding:12px;font-size:1em;background:#fff;color:#23242a;border:none;border-radius:8px;font-weight:bold;cursor:pointer;">Juega otra vez</button>
  <button id="btnReanudar" style="margin:0 18px 0 18px;padding:12px;font-size:1em;background:#2196f3;color:#fff;border:none;border-radius:8px;font-weight:bold;cursor:pointer;">Reanudar</button>
    </div>
  `;
  document.body.appendChild(modal);
  document.getElementById('btnReanudar').onclick = ocultarMenuModal;
  document.getElementById('btnReiniciarJuego').onclick = function() {
    ocultarMenuModal();
    // Reiniciar juego
    preguntaActual = 0;
    aciertos = 0;
    tiempoInicio = Date.now();
    actualizarContadores();
    actualizarCronometro();
    if (cronometroInterval) clearInterval(cronometroInterval);
    cronometroInterval = setInterval(actualizarCronometro, 1000);
    mostrarPregunta();
    document.getElementById('pantallaInicio').style.display = 'none';
    document.getElementById('mensajeBienvenida').style.display = 'none';
    document.getElementById('juegoContainer').style.display = 'flex';
  };
  document.getElementById('btnMenuPrincipal').onclick = function() {
    window.location.href = '../index.html';
  };
}

function ocultarMenuModal() {
  const modal = document.getElementById('menuModal');
  if (modal) {
    modal.remove();
  }
  // Reanudar cronómetro
  if (cronometroPausado) {
    tiempoInicio += Date.now() - tiempoPausa;
    cronometroInterval = setInterval(actualizarCronometro, 1000);
    cronometroPausado = false;
  }
}

// Event listeners
document.getElementById('btnIniciarJuego').onclick = function() {
  cargarPreguntas();
};
document.getElementById('btnMenu').onclick = function() {
  mostrarMenuModal();
};
</script>
</body>
</html>
